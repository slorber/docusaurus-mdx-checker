"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[511],{8503:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>p,frontMatter:()=>a,metadata:()=>h,toc:()=>m});var t=s(4246),o=s(1670),i=s(8447),l=s(2599),c=s(6146),r=s(6294);const a={id:"jest-object",title:"Jest \u5bf9\u8c61"},d=void 0,h={unversionedId:"jest-object",id:"version-29.4/jest-object",title:"Jest \u5bf9\u8c61",description:"jest \u5bf9\u8c61\u4f1a\u81ea\u52a8\u6ce8\u5165\u5230\u6bcf\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u4e2d\uff0c jest \u5bf9\u8c61\u4e0a\u7684\u65b9\u6cd5\u5e2e\u52a9\u4f60\u521b\u5efa\u6a21\u62df\u5e76\u8ba9\u4f60\u63a7\u5236 Jest \u7684\u6574\u4f53\u884c\u4e3a\u3002 \u4e5f\u53ef\u4ee5\u901a\u8fc7 import { jest } from '@jest/globals' \u624b\u52a8\u8fdb\u884c\u5f15\u5165\u3002",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/version-29.4/JestObjectAPI.md",sourceDirName:".",slug:"/jest-object",permalink:"/zh-Hans/docs/29.4/jest-object",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/project/jest-v2/zh-CN",tags:[],version:"29.4",frontMatter:{id:"jest-object",title:"Jest \u5bf9\u8c61"},sidebar:"api",previous:{title:"\u6a21\u62df\u51fd\u6570",permalink:"/zh-Hans/docs/29.4/mock-function-api"},next:{title:"Jest \u914d\u7f6e",permalink:"/zh-Hans/docs/29.4/configuration"}},u={},m=[{value:"\u65b9\u6cd5",id:"\u65b9\u6cd5",level:2},{value:"Mock Modules",id:"mock-modules",level:2},{value:"<code>jest.disableAutomock()</code>",id:"jestdisableautomock",level:3},{value:"<code>jest.enableAutomock()</code>",id:"jestenableautomock",level:3},{value:"<code>jest.createMockFromModule(moduleName)</code>",id:"jestcreatemockfrommodulemodulename",level:3},{value:"<code>\u51fd\u6570</code>",id:"\u51fd\u6570",level:4},{value:"<code>\u7c7b</code>",id:"\u7c7b",level:4},{value:"<code>\u5bf9\u8c61</code>",id:"\u5bf9\u8c61",level:4},{value:"<code>\u6570\u7ec4</code>",id:"\u6570\u7ec4",level:4},{value:"<code>\u57fa\u672c\u7c7b\u578b</code>",id:"\u57fa\u672c\u7c7b\u578b",level:4},{value:"<code>jest.mock(moduleName, factory, options)</code>",id:"jestmockmodulename-factory-options",level:3},{value:"<code>jest.Mocked&lt;Source&gt;</code>",id:"jestmockedsource",level:3},{value:"<code>jest.mocked(source, options?)</code>",id:"jestmockedsource-options",level:3},{value:"<code>jest.unmock(moduleName)</code>",id:"jestunmockmodulename",level:3},{value:"<code>jest.deepUnmock(moduleName)</code>",id:"jestdeepunmockmodulename",level:3},{value:"<code>jest.doMock(moduleName, factory, options)</code>",id:"jestdomockmodulename-factory-options",level:3},{value:"<code>jest.dontMock(moduleName)</code>",id:"jestdontmockmodulename",level:3},{value:"<code>jest.setMock(moduleName, moduleExports)</code>",id:"jestsetmockmodulename-moduleexports",level:3},{value:"<code>jest.requireActual(moduleName)</code>",id:"jestrequireactualmodulename",level:3},{value:"<code>jest.requireMock(moduleName)</code>",id:"jestrequiremockmodulename",level:3},{value:"<code>jest.resetModules()</code>",id:"jestresetmodules",level:3},{value:"<code>jest.isolateModules(fn)</code>",id:"jestisolatemodulesfn",level:3},{value:"<code>jest.isolateModulesAsync(fn)</code>",id:"jestisolatemodulesasyncfn",level:3},{value:"\u6a21\u62df\u51fd\u6570",id:"\u6a21\u62df\u51fd\u6570",level:2},{value:"<code>jest.fn(implementation?)</code>",id:"jestfnimplementation",level:3},{value:"<code>jest.isMockFunction(fn)</code>",id:"jestismockfunctionfn",level:3},{value:"<code>jest.replaceProperty(object, propertyKey, value)</code>",id:"jestreplacepropertyobject-propertykey-value",level:3},{value:"<code>jest.spyOn(object, methodName)</code>",id:"jestspyonobject-methodname",level:3},{value:"<code>jest.spyOn(object, methodName, accessType?)</code>",id:"jestspyonobject-methodname-accesstype",level:3},{value:"<code>jest.Replaced&lt;Source&gt;</code>",id:"jestreplacedsource",level:3},{value:"<code>jest.Spied&lt;Source&gt;</code>",id:"jestspiedsource",level:3},{value:"<code>jest.clearAllMocks()</code>",id:"jestclearallmocks",level:3},{value:"<code>jest.resetAllMocks()</code>",id:"jestresetallmocks",level:3},{value:"<code>jest.restoreAllMocks()</code>",id:"jestrestoreallmocks",level:3},{value:"\u5047\u7684\u5b9a\u65f6\u5668",id:"\u5047\u7684\u5b9a\u65f6\u5668",level:2},{value:"<code>jest.useFakeTimers(fakeTimersConfig?)</code>",id:"jestusefaketimersfaketimersconfig",level:3},{value:"<code>jest.useRealTimers()</code>",id:"jestuserealtimers",level:3},{value:"<code>jest.runAllTicks()</code>",id:"jestrunallticks",level:3},{value:"<code>jest.runAllTimers()</code>",id:"jestrunalltimers",level:3},{value:"<code>jest.runAllImmediates()</code>",id:"jestrunallimmediates",level:3},{value:"<code>jest.advanceTimersByTime(msToRun)</code>",id:"jestadvancetimersbytimemstorun",level:3},{value:"<code>jest.runOnlyPendingTimers()</code>",id:"jestrunonlypendingtimers",level:3},{value:"<code>jest.advanceTimersToNextTimer(steps)</code>",id:"jestadvancetimerstonexttimersteps",level:3},{value:"<code>jest.clearAllTimers()</code>",id:"jestclearalltimers",level:3},{value:"<code>jest.getTimerCount()</code>",id:"jestgettimercount",level:3},{value:"<code>jest.now()</code>",id:"jestnow",level:3},{value:"<code>jest.setSystemTime(now?: number | Date)</code>",id:"jestsetsystemtimenow-number--date",level:3},{value:"<code>jest.getRealSystemTime()</code>",id:"jestgetrealsystemtime",level:3},{value:"Misc",id:"misc",level:2},{value:"<code>jest.getSeed()</code>",id:"jestgetseed",level:3},{value:"<code>jest.isEnvironmentTornDown()</code>",id:"jestisenvironmenttorndown",level:3},{value:"<code>jest.retryTimes(numRetries, options?)</code>",id:"jestretrytimesnumretries-options",level:3},{value:"<code>jest.setTimeout(timeout)</code>",id:"jestsettimeouttimeout",level:3}];function j(e){const n=Object.assign({p:"p",code:"code",h2:"h2",hr:"hr",h3:"h3",admonition:"admonition",a:"a",pre:"pre",h4:"h4",ul:"ul",li:"li",strong:"strong"},(0,o.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u4f1a\u81ea\u52a8\u6ce8\u5165\u5230\u6bcf\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u4e2d\uff0c ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u4e0a\u7684\u65b9\u6cd5\u5e2e\u52a9\u4f60\u521b\u5efa\u6a21\u62df\u5e76\u8ba9\u4f60\u63a7\u5236 Jest \u7684\u6574\u4f53\u884c\u4e3a\u3002 \u4e5f\u53ef\u4ee5\u901a\u8fc7 ",(0,t.jsx)(n.code,{children:"import { jest } from '@jest/globals'"})," \u624b\u52a8\u8fdb\u884c\u5f15\u5165\u3002"]}),"\n","\n",(0,t.jsx)(c.ZP,{}),"\n",(0,t.jsx)(n.h2,{id:"\u65b9\u6cd5",children:"\u65b9\u6cd5"}),"\n","\n","\n",(0,t.jsx)(r.Z,{toc:m.slice(1)}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"mock-modules",children:"Mock Modules"}),"\n",(0,t.jsx)(n.h3,{id:"jestdisableautomock",children:(0,t.jsx)(n.code,{children:"jest.disableAutomock()"})}),"\n",(0,t.jsx)(n.p,{children:"Disables automatic mocking in the module loader."}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["Automatic mocking should be enabled via ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/configuration#automock-boolean",children:(0,t.jsx)(n.code,{children:"automock"})})," configuration option for this method to have any effect. Also see documentation of the configuration option for more details."]}),(0,t.jsxs)(i.Z,{groupId:"code-examples",children:[(0,t.jsx)(l.Z,{value:"js",label:"JavaScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:"tab",children:"/** @type {import('jest').Config} */\nconst config = {\n  automock: true,\n};\n\nmodule.exports = config;\n"})})}),(0,t.jsx)(l.Z,{value:"ts",label:"TypeScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"tab",children:"import type {Config} from 'jest';\n\nconst config: Config = {\n  automock: true,\n};\n\nexport default config;\n"})})})]})]}),"\n",(0,t.jsxs)(n.p,{children:["After ",(0,t.jsx)(n.code,{children:"disableAutomock()"})," is called, all ",(0,t.jsx)(n.code,{children:"require()"}),"s will return the real versions of each module (rather than a mocked version)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="utils.js"',children:"export default {\n  authorize: () => {\n    return 'token';\n  },\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__tests__/disableAutomocking.js"',children:"import utils from '../utils';\n\njest.disableAutomock();\n\ntest('original implementation', () => {\n  // now we have the original implementation,\n  // even if we set the automocking in a jest configuration\n  expect(utils.authorize()).toBe('token');\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:'This is usually useful when you have a scenario where the number of dependencies you want to mock is far less than the number of dependencies that you don\'t. For example, if you\'re writing a test for a module that uses a large number of dependencies that can be reasonably classified as "implementation details" of the module, then you likely do not want to mock them. For example, if you\'re writing a test for a module that uses a large number of dependencies that can be reasonably classified as "implementation details" of the module, then you likely do not want to mock them.'}),"\n",(0,t.jsxs)(n.p,{children:['Examples of dependencies that might be considered "implementation details" are things ranging from language built-ins (e.g. ',(0,t.jsx)(n.code,{children:"Array.prototype"})," methods) to highly common utility methods (e.g. ",(0,t.jsx)(n.code,{children:"underscore"}),", ",(0,t.jsx)(n.code,{children:"lodash"}),", array utilities, etc) and entire libraries like ",(0,t.jsx)(n.code,{children:"React.js"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"babel-jest"}),", calls to ",(0,t.jsx)(n.code,{children:"disableAutomock()"})," will automatically be hoisted to the top of the code block. Use ",(0,t.jsx)(n.code,{children:"autoMockOff()"})," if you want to explicitly avoid this behavior."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestenableautomock",children:(0,t.jsx)(n.code,{children:"jest.enableAutomock()"})}),"\n",(0,t.jsx)(n.p,{children:"Enables automatic mocking in the module loader."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["For more details on automatic mocking see documentation of ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/configuration#automock-boolean",children:(0,t.jsx)(n.code,{children:"automock"})})," configuration option."]})}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="utils.js"',children:"export default {\n  authorize: () => {\n    return 'token';\n  },\n  isAuthorized: secret => secret === 'wizard',\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__tests__/enableAutomocking.js"',children:"jest.enableAutomock();\n\nimport utils from '../utils';\n\ntest('original implementation', () => {\n  // now we have the mocked implementation,\n  expect(utils.authorize._isMockFunction).toBeTruthy();\n  expect(utils.isAuthorized._isMockFunction).toBeTruthy();\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"babel-jest"}),", calls to ",(0,t.jsx)(n.code,{children:"enableAutomock"})," will automatically be hoisted to the top of the code block. Use ",(0,t.jsx)(n.code,{children:"autoMockOn"})," if you want to explicitly avoid this behavior."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestcreatemockfrommodulemodulename",children:(0,t.jsx)(n.code,{children:"jest.createMockFromModule(moduleName)"})}),"\n",(0,t.jsx)(n.p,{children:"Given the name of a module, use the automatic mocking system to generate a mocked version of the module for you."}),"\n",(0,t.jsxs)(n.p,{children:["This is useful when you want to create a ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/manual-mocks",children:"manual mock"})," that extends the automatic mock's behavior:"]}),"\n",(0,t.jsxs)(i.Z,{groupId:"code-examples",children:[(0,t.jsxs)(l.Z,{value:"js",label:"JavaScript",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'tab={"span":2} title="utils.js"',children:"module.exports = {\n  authorize: () => {\n    return 'token';\n  },\n  isAuthorized: secret => secret === 'wizard',\n};\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__tests__/createMockFromModule.test.js"',children:"const utils = jest.createMockFromModule('../utils');\n\nutils.isAuthorized = jest.fn(secret => secret === 'not wizard');\n\ntest('implementation created by jest.createMockFromModule', () => {\n  expect(jest.isMockFunction(utils.authorize)).toBe(true);\n  expect(utils.isAuthorized('not wizard')).toBe(true);\n});\n"})})]}),(0,t.jsxs)(l.Z,{value:"ts",label:"TypeScript",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'tab={"span":2} title="utils.ts"',children:"export const utils = {\n  authorize: () => {\n    return 'token';\n  },\n  isAuthorized: (secret: string) => secret === 'wizard',\n};\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:'title="__tests__/createMockFromModule.test.ts"',children:"const {utils} =\n  jest.createMockFromModule<typeof import('../utils')>('../utils');\n\nutils.isAuthorized = jest.fn((secret: string) => secret === 'not wizard');\n\ntest('implementation created by jest.createMockFromModule', () => {\n  expect(jest.isMockFunction(utils.authorize)).toBe(true);\n  expect(utils.isAuthorized('not wizard')).toBe(true);\n});\n"})})]})]}),"\n",(0,t.jsxs)(n.p,{children:["This is how ",(0,t.jsx)(n.code,{children:"createMockFromModule"})," will mock the following data types:"]}),"\n",(0,t.jsx)(n.h4,{id:"\u51fd\u6570",children:(0,t.jsx)(n.code,{children:"\u51fd\u6570"})}),"\n",(0,t.jsxs)(n.p,{children:["Creates a new ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api",children:"mock function"}),". The new function has no formal parameters and when called will return ",(0,t.jsx)(n.code,{children:"undefined"}),". This functionality also applies to ",(0,t.jsx)(n.code,{children:"async"})," functions."]}),"\n",(0,t.jsx)(n.h4,{id:"\u7c7b",children:(0,t.jsx)(n.code,{children:"\u7c7b"})}),"\n",(0,t.jsx)(n.p,{children:"Creates a new class. Creates a new class. The interface of the original class is maintained, all of the class member functions and properties will be mocked."}),"\n",(0,t.jsx)(n.h4,{id:"\u5bf9\u8c61",children:(0,t.jsx)(n.code,{children:"\u5bf9\u8c61"})}),"\n",(0,t.jsx)(n.p,{children:"Creates a new deeply cloned object. Creates a new deeply cloned object. The object keys are maintained and their values are mocked."}),"\n",(0,t.jsx)(n.h4,{id:"\u6570\u7ec4",children:(0,t.jsx)(n.code,{children:"\u6570\u7ec4"})}),"\n",(0,t.jsx)(n.p,{children:"Creates a new empty array, ignoring the original."}),"\n",(0,t.jsx)(n.h4,{id:"\u57fa\u672c\u7c7b\u578b",children:(0,t.jsx)(n.code,{children:"\u57fa\u672c\u7c7b\u578b"})}),"\n",(0,t.jsx)(n.p,{children:"Creates a new property with the same primitive value as the original property."}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="example.js"',children:"module.exports = {\n  function: function square(a, b) {\n    return a * b;\n  },\n  asyncFunction: async function asyncSquare(a, b) {\n    const result = (await a) * b;\n    return result;\n  },\n  class: new (class Bar {\n    constructor() {\n      this.array = [1, 2, 3];\n    }\n    foo() {}\n  })(),\n  object: {\n    baz: 'foo',\n    bar: {\n      fiz: 1,\n      buzz: [1, 2, 3],\n    },\n  },\n  array: [1, 2, 3],\n  number: 123,\n  string: 'baz',\n  boolean: true,\n  symbol: Symbol.for('a.b.c'),\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__tests__/example.test.js"',children:"const example = jest.createMockFromModule('../example');\n\ntest('should run example code', () => {\n  // creates a new mocked function with no formal arguments.\n  expect(example.function.name).toBe('square');\n  expect(example.function).toHaveLength(0);\n\n  // async functions get the same treatment as standard synchronous functions.\n  expect(example.asyncFunction.name).toBe('asyncSquare');\n  expect(example.asyncFunction).toHaveLength(0);\n\n  // creates a new class with the same interface, member functions and properties are mocked.\n  expect(example.class.constructor.name).toBe('Bar');\n  expect(example.class.foo.name).toBe('foo');\n  expect(example.class.array).toHaveLength(0);\n\n  // creates a deeply cloned version of the original object.\n  expect(example.object).toEqual({\n    baz: 'foo',\n    bar: {\n      fiz: 1,\n      buzz: [],\n    },\n  });\n\n  // creates a new empty array, ignoring the original array.\n  expect(example.array).toHaveLength(0);\n\n  // creates a new property with the same primitive value as the original property.\n  expect(example.number).toBe(123);\n  expect(example.string).toBe('baz');\n  expect(example.boolean).toBe(true);\n  expect(example.symbol).toEqual(Symbol.for('a.b.c'));\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jestmockmodulename-factory-options",children:(0,t.jsx)(n.code,{children:"jest.mock(moduleName, factory, options)"})}),"\n",(0,t.jsxs)(n.p,{children:["Mocks a module with an auto-mocked version when it is being required. ",(0,t.jsx)(n.code,{children:"factory"})," and ",(0,t.jsx)(n.code,{children:"options"})," are optional. For example: ",(0,t.jsx)(n.code,{children:"factory"})," and ",(0,t.jsx)(n.code,{children:"options"})," are optional. \u4f8b\u5982\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="banana.js"',children:"module.exports = () => 'banana';\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__tests__/test.js"',children:"jest.mock('../banana');\n\nconst banana = require('../banana'); // banana will be explicitly mocked.\n\nbanana(); // will return 'undefined' because the function is auto-mocked.\n"})}),"\n",(0,t.jsx)(n.p,{children:"The second argument can be used to specify an explicit module factory that is being run instead of using Jest's automocking feature:"}),"\n",(0,t.jsxs)(i.Z,{groupId:"code-examples",children:[(0,t.jsx)(l.Z,{value:"js",label:"JavaScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:"tab",children:"jest.mock('../moduleName', () => {\n  return jest.fn(() => 42);\n});\n\n// This runs the function specified as second argument to `jest.mock`.\nconst moduleName = require('../moduleName');\nmoduleName(); // Will return '42';\nconst moduleName = require('../moduleName');\nmoduleName(); // Will return '42';\n"})})}),(0,t.jsx)(l.Z,{value:"ts",label:"TypeScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"tab",children:"// The optional type argument provides typings for the module factory\njest.mock<typeof import('../moduleName')>('../moduleName', () => {\n  return jest.fn(() => 42);\n});\n\n// This runs the function specified as second argument to `jest.mock`.\nconst moduleName = require('../moduleName');\nmoduleName(); // Will return '42';\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:["When using the ",(0,t.jsx)(n.code,{children:"factory"})," parameter for an ES6 module with a default export, the ",(0,t.jsx)(n.code,{children:"__esModule: true"})," property needs to be specified. This property is normally generated by Babel / TypeScript, but here it needs to be set manually. When importing a default export, it's an instruction to import the property named ",(0,t.jsx)(n.code,{children:"default"})," from the export object: This property is normally generated by Babel / TypeScript, but here it needs to be set manually. When importing a default export, it's an instruction to import the property named ",(0,t.jsx)(n.code,{children:"default"})," from the export object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"import moduleName, {foo} from '../moduleName';\n\njest.mock('../moduleName', () => {\n  return {\n    __esModule: true,\n    default: jest.fn(() => 42),\n    foo: jest.fn(() => 43),\n  };\n});\n\nmoduleName(); // Will return 42\nfoo(); // Will return 43\n"})}),"\n",(0,t.jsx)(n.p,{children:"The third argument can be used to create virtual mocks \u2013 mocks of modules that don't exist anywhere in the system:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"jest.mock(\n  '../moduleName',\n  () => {\n    /*\n     * Custom implementation of a module that doesn't exist in JS,\n     * like a generated module or a native module in react-native.\n     */\n  },\n  {virtual: true},\n);\n     */\n  },\n  {virtual: true},\n);\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Importing a module in a setup file (as specified by ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/configuration#setupfilesafterenv-array",children:(0,t.jsx)(n.code,{children:"setupFilesAfterEnv"})}),") will prevent mocking for the module in question, as well as all the modules that it imports."]})}),"\n",(0,t.jsxs)(n.p,{children:["Modules that are mocked with ",(0,t.jsx)(n.code,{children:"jest.mock"})," are mocked only for the file that calls ",(0,t.jsx)(n.code,{children:"jest.mock"}),". Another file that imports the module will get the original implementation even if it runs after the test file that mocks the module. Another file that imports the module will get the original implementation even if it runs after the test file that mocks the module."]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Writing tests in TypeScript? Use the ",(0,t.jsx)(n.a,{href:"MockFunctionAPI.md/#jestmockedsource",children:(0,t.jsx)(n.code,{children:"jest.Mocked"})})," utility type or the ",(0,t.jsx)(n.a,{href:"MockFunctionAPI.md/#jestmockedsource-options",children:(0,t.jsx)(n.code,{children:"jest.mocked()"})})," helper method to have your mocked modules typed."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestmockedsource",children:(0,t.jsx)(n.code,{children:"jest.Mocked<Source>"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"MockFunctionAPI.md/#jestmockedsource",children:"TypeScript Usage"})," chapter of Mock Functions page for documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"jestmockedsource-options",children:(0,t.jsx)(n.code,{children:"jest.mocked(source, options?)"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"MockFunctionAPI.md/#jestmockedsource-options",children:"TypeScript Usage"})," chapter of Mock Functions page for documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"jestunmockmodulename",children:(0,t.jsx)(n.code,{children:"jest.unmock(moduleName)"})}),"\n",(0,t.jsxs)(n.p,{children:["Indicates that the module system should never return a mocked version of the specified module from ",(0,t.jsx)(n.code,{children:"require()"})," (e.g. that it should always return the real module)."]}),"\n",(0,t.jsx)(n.p,{children:"The most common use of this API is for specifying the module a given test intends to be testing (and thus doesn't want automatically mocked)."}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestdeepunmockmodulename",children:(0,t.jsx)(n.code,{children:"jest.deepUnmock(moduleName)"})}),"\n",(0,t.jsx)(n.p,{children:"Indicates that the module system should never return a mocked version of the specified module and its dependencies."}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestdomockmodulename-factory-options",children:(0,t.jsx)(n.code,{children:"jest.doMock(moduleName, factory, options)"})}),"\n",(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"babel-jest"}),", calls to ",(0,t.jsx)(n.code,{children:"mock"})," will automatically be hoisted to the top of the code block. Use this method if you want to explicitly avoid this behavior."]}),"\n",(0,t.jsx)(n.p,{children:"One example when this is useful is when you want to mock a module differently within the same file:"}),"\n",(0,t.jsxs)(i.Z,{groupId:"code-examples",children:[(0,t.jsx)(l.Z,{value:"js",label:"JavaScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:"tab",children:"beforeEach(() => {\n  jest.resetModules();\n});\n\ntest('moduleName 1', () => {\n  jest.doMock('../moduleName', () => {\n    return jest.fn(() => 1);\n  });\n  const moduleName = require('../moduleName');\n  expect(moduleName()).toBe(1);\n});\n\ntest('moduleName 2', () => {\n  jest.doMock('../moduleName', () => {\n    return jest.fn(() => 2);\n  });\n  const moduleName = require('../moduleName');\n  expect(moduleName()).toBe(2);\n});\n"})})}),(0,t.jsx)(l.Z,{value:"ts",label:"TypeScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"tab",children:"beforeEach(() => {\n  jest.resetModules();\n});\n\ntest('moduleName 1', () => {\n  // The optional type argument provides typings for the module factory\n  jest.doMock<typeof import('../moduleName')>('../moduleName', () => {\n    return jest.fn(() => 1);\n  });\n  const moduleName = require('../moduleName');\n  expect(moduleName()).toBe(1);\n});\n\ntest('moduleName 2', () => {\n  jest.doMock<typeof import('../moduleName')>('../moduleName', () => {\n    return jest.fn(() => 2);\n  });\n  const moduleName = require('../moduleName');\n  expect(moduleName()).toBe(2);\n});\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"jest.doMock()"})," with ES6 imports requires additional steps. Follow these if you don't want to use ",(0,t.jsx)(n.code,{children:"require"})," in your tests: Follow these if you don't want to use ",(0,t.jsx)(n.code,{children:"require"})," in your tests:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5fc5\u987b\u6307\u5b9a ",(0,t.jsx)(n.code,{children:"__esModule: true"})," \u5c5e\u6027\uff08\u89c1 ",(0,t.jsx)(n.a,{href:"#jestmockmodulename-factory-options",children:(0,t.jsx)(n.code,{children:"jest.mock()"})})," API\u4ee5\u83b7\u53d6\u66f4\u591a\u4fe1\u606f\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:["\u9759\u6001\u7684 ES6 \u6a21\u5757\u5bfc\u5165\u8bed\u53e5\u5c06\u4f1a\u88ab\u7f6e\u4e8e\u6587\u4ef6\u9876\u90e8\uff0c\u6240\u4ee5\u5e94\u8be5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"import()"})," \u8fdb\u884c\u6a21\u5757\u7684\u52a8\u6001\u5bfc\u5165"]}),"\n",(0,t.jsxs)(n.li,{children:["\u6700\u540e\uff0c\u9700\u8981\u4e00\u4e2a\u652f\u6301\u52a8\u6001\u5bfc\u5165\u7684\u73af\u5883\u3002 \u8bf7\u67e5\u770b ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/getting-started#using-babel",children:"\u4f7f\u7528 Babel"})," \u8fdb\u884c\u521d\u59cb\u8bbe\u7f6e\u3002 \u7136\u540e\u6dfb\u52a0 ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/babel-plugin-dynamic-import-node",children:"babel-plugin-dynamic-import-node"})," \u63d2\u4ef6\u6216\u8005\u5176\u4ed6\u6709\u76f8\u540c\u529f\u80fd\u7684\u63d2\u4ef6\u6765\u786e\u4fdd Babel \u5f00\u542f\u4e86\u5728 Node \u4e2d\u52a8\u6001\u5bfc\u5165\u7684\u914d\u7f6e\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"beforeEach(() => {\n  jest.resetModules();\n});\n\ntest('moduleName 1', () => {\n  jest.doMock('../moduleName', () => {\n    return {\n      __esModule: true,\n      default: 'default1',\n      foo: 'foo1',\n    };\n  });\n  return import('../moduleName').then(moduleName => {\n    expect(moduleName.default).toBe('default1');\n    expect(moduleName.foo).toBe('foo1');\n  });\n});\n\ntest('moduleName 2', () => {\n  jest.doMock('../moduleName', () => {\n    return {\n      __esModule: true,\n      default: 'default2',\n      foo: 'foo2',\n    };\n  });\n  return import('../moduleName').then(moduleName => {\n    expect(moduleName.default).toBe('default2');\n    expect(moduleName.foo).toBe('foo2');\n  });\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestdontmockmodulename",children:(0,t.jsx)(n.code,{children:"jest.dontMock(moduleName)"})}),"\n",(0,t.jsxs)(n.p,{children:["When using ",(0,t.jsx)(n.code,{children:"babel-jest"}),", calls to ",(0,t.jsx)(n.code,{children:"unmock"})," will automatically be hoisted to the top of the code block. Use this method if you want to explicitly avoid this behavior. Use this method if you want to explicitly avoid this behavior."]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestsetmockmodulename-moduleexports",children:(0,t.jsx)(n.code,{children:"jest.setMock(moduleName, moduleExports)"})}),"\n",(0,t.jsx)(n.p,{children:"Explicitly supplies the mock object that the module system should return for the specified module."}),"\n",(0,t.jsxs)(n.p,{children:["On occasion, there are times where the automatically generated mock the module system would normally provide you isn't adequate enough for your testing needs. On occasion, there are times where the automatically generated mock the module system would normally provide you isn't adequate enough for your testing needs. Normally under those circumstances you should write a ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/manual-mocks",children:"manual mock"})," that is more adequate for the module in question. However, on extremely rare occasions, even a manual mock isn't suitable for your purposes and you need to build the mock yourself inside your test. However, on extremely rare occasions, even a manual mock isn't suitable for your purposes and you need to build the mock yourself inside your test."]}),"\n",(0,t.jsx)(n.p,{children:"In these rare scenarios you can use this API to manually fill the slot in the module system's mock-module registry."}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["It is recommended to use ",(0,t.jsx)(n.a,{href:"#jestmockmodulename-factory-options",children:(0,t.jsx)(n.code,{children:"jest.mock()"})})," instead. The ",(0,t.jsx)(n.code,{children:"jest.mock"})," API's second argument is a module factory instead of the expected exported module object."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestrequireactualmodulename",children:(0,t.jsx)(n.code,{children:"jest.requireActual(moduleName)"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the actual module instead of a mock, bypassing all checks on whether the module should receive a mock implementation or not."}),"\n",(0,t.jsxs)(i.Z,{groupId:"code-examples",children:[(0,t.jsx)(l.Z,{value:"js",label:"JavaScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:"tab",children:"jest.mock('../myModule', () => {\n  // Require the original module to not be mocked...\n  const originalModule = jest.requireActual('../myModule');\n\n  return {\n    __esModule: true, // Use it when dealing with esModules\n    ...originalModule,\n    getRandom: jest.fn(() => 10),\n  };\n});\n\nconst getRandom = require('../myModule').getRandom;\n\ngetRandom(); // Always returns 10\n"})})}),(0,t.jsx)(l.Z,{value:"ts",label:"TypeScript",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"tab",children:"jest.mock('../myModule', () => {\n  // Require the original module to not be mocked...\n  const originalModule =\n    jest.requireActual<typeof import('../myModule')>('../myModule');\n\n  return {\n    __esModule: true, // Use it when dealing with esModules\n    ...originalModule,\n    getRandom: jest.fn(() => 10),\n  };\n});\n\nconst getRandom = require('../myModule').getRandom;\n\ngetRandom(); // Always returns 10\n"})})})]}),"\n",(0,t.jsx)(n.h3,{id:"jestrequiremockmodulename",children:(0,t.jsx)(n.code,{children:"jest.requireMock(moduleName)"})}),"\n",(0,t.jsx)(n.p,{children:"Returns a mock module instead of the actual module, bypassing all checks on whether the module should be required normally or not."}),"\n",(0,t.jsx)(n.h3,{id:"jestresetmodules",children:(0,t.jsx)(n.code,{children:"jest.resetModules()"})}),"\n",(0,t.jsx)(n.p,{children:"Resets the module registry - the cache of all required modules. Resets the module registry - the cache of all required modules. This is useful to isolate modules where local state might conflict between tests."}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const sum1 = require('../sum');\njest.resetModules();\nconst sum2 = require('../sum');\nsum1 === sum2;\n// > false (Both sum modules are separate \"instances\" of the sum module.)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example in a test:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"beforeEach(() => {\n  jest.resetModules();\n});\n\ntest('works', () => {\n  const sum = require('../sum');\n});\n\ntest('works too', () => {\n  const sum = require('../sum');\n  // sum is a different copy of the sum module from the previous test.\n});\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestisolatemodulesfn",children:(0,t.jsx)(n.code,{children:"jest.isolateModules(fn)"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"jest.isolateModules(fn)"})," goes a step further than ",(0,t.jsx)(n.code,{children:"jest.resetModules()"})," and creates a sandbox registry for the modules that are loaded inside the callback function. This is useful to isolate specific modules for every test so that local module state doesn't conflict between tests. This is useful to isolate specific modules for every test so that local module state doesn't conflict between tests."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"let myModule;\njest.isolateModules(() => {\n  myModule = require('myModule');\n});\n\nconst otherCopyOfMyModule = require('myModule');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jestisolatemodulesasyncfn",children:(0,t.jsx)(n.code,{children:"jest.isolateModulesAsync(fn)"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"jest.isolateModulesAsync()"})," is the equivalent of ",(0,t.jsx)(n.code,{children:"jest.isolateModules()"}),", but for async callbacks. The caller is expected to ",(0,t.jsx)(n.code,{children:"await"})," the completion of ",(0,t.jsx)(n.code,{children:"isolateModulesAsync"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"let myModule;\nawait jest.isolateModulesAsync(async () => {\n  myModule = await import('myModule');\n  // do async stuff here\n});\n\nconst otherCopyOfMyModule = await import('myModule');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6a21\u62df\u51fd\u6570",children:"\u6a21\u62df\u51fd\u6570"}),"\n",(0,t.jsx)(n.h3,{id:"jestfnimplementation",children:(0,t.jsx)(n.code,{children:"jest.fn(implementation?)"})}),"\n",(0,t.jsxs)(n.p,{children:["Returns a new, unused ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api",children:"mock function"}),". Optionally takes a mock implementation. Optionally takes a mock implementation."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const mockFn = jest.fn();\nmockFn();\nexpect(mockFn).toHaveBeenCalled();\n\n// With a mock implementation:\nconst returnsTrue = jest.fn(() => true);\nconsole.log(returnsTrue()); // true;\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#jestfnimplementation",children:"Mock Functions"})," page for details on TypeScript usage."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestismockfunctionfn",children:(0,t.jsx)(n.code,{children:"jest.isMockFunction(fn)"})}),"\n",(0,t.jsx)(n.p,{children:"Determines if the given function is a mocked function."}),"\n",(0,t.jsx)(n.h3,{id:"jestreplacepropertyobject-propertykey-value",children:(0,t.jsx)(n.code,{children:"jest.replaceProperty(object, propertyKey, value)"})}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"object[propertyKey]"})," with a ",(0,t.jsx)(n.code,{children:"value"}),". The property must already exist on the object. The same property might be replaced multiple times. Returns a Jest ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#replaced-properties",children:"replaced property"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["To mock properties that are defined as getters or setters, use ",(0,t.jsx)(n.a,{href:"#jestspyonobject-methodname-accesstype",children:(0,t.jsx)(n.code,{children:"jest.spyOn(object, methodName, accessType)"})})," instead. To mock functions, use ",(0,t.jsx)(n.a,{href:"#jestspyonobject-methodname",children:(0,t.jsx)(n.code,{children:"jest.spyOn(object, methodName)"})})," instead."]})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["All properties replaced with ",(0,t.jsx)(n.code,{children:"jest.replaceProperty"})," could be restored to the original value by calling ",(0,t.jsx)(n.a,{href:"#jestrestoreallmocks",children:"jest.restoreAllMocks"})," on ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/api#aftereachfn-timeout",children:"afterEach"})," method."]})}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const utils = {\n  isLocalhost() {\n    return process.env.HOSTNAME === 'localhost';\n  },\n};\n\nmodule.exports = utils;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example test:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const utils = require('./utils');\n\nafterEach(() => {\n  // restore replaced property\n  jest.restoreAllMocks();\n});\n\ntest('isLocalhost returns true when HOSTNAME is localhost', () => {\n  jest.replaceProperty(process, 'env', {HOSTNAME: 'localhost'});\n  expect(utils.isLocalhost()).toBe(true);\n});\n\ntest('isLocalhost returns false when HOSTNAME is not localhost', () => {\n  jest.replaceProperty(process, 'env', {HOSTNAME: 'not-localhost'});\n  expect(utils.isLocalhost()).toBe(false);\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jestspyonobject-methodname",children:(0,t.jsx)(n.code,{children:"jest.spyOn(object, methodName)"})}),"\n",(0,t.jsxs)(n.p,{children:["Creates a mock function similar to ",(0,t.jsx)(n.code,{children:"jest.fn"})," but also tracks calls to ",(0,t.jsx)(n.code,{children:"object[methodName]"}),". Returns a Jest ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api",children:"mock function"}),". Returns a Jest ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api",children:"mock function"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["By default, ",(0,t.jsx)(n.code,{children:"jest.spyOn"})," also calls the ",(0,t.jsx)(n.strong,{children:"spied"})," method. This is different behavior from most other test libraries. If you want to overwrite the original function, you can use ",(0,t.jsx)(n.code,{children:"jest.spyOn(object, methodName).mockImplementation(() => customImplementation)"})," or ",(0,t.jsx)(n.code,{children:"object[methodName] = jest.fn(() => customImplementation)"}),"."]})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Since ",(0,t.jsx)(n.code,{children:"jest.spyOn"})," is a mock, you could restore the initial state by calling ",(0,t.jsx)(n.a,{href:"#jestrestoreallmocks",children:(0,t.jsx)(n.code,{children:"jest.restoreAllMocks"})})," in the body of the callback passed to the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/api#aftereachfn-timeout",children:"afterEach"})," hook."]})}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const video = {\n  play() {\n    return true;\n  },\n};\n\nmodule.exports = video;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example test:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const video = require('./video');\n\nafterEach(() => {\n  // restore the spy created with spyOn\n  jest.restoreAllMocks();\n});\n\ntest('plays video', () => {\n  const spy = jest.spyOn(video, 'play');\n  const isPlaying = video.play();\n\n  expect(spy).toHaveBeenCalled();\n  expect(isPlaying).toBe(true);\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jestspyonobject-methodname-accesstype",children:(0,t.jsx)(n.code,{children:"jest.spyOn(object, methodName, accessType?)"})}),"\n",(0,t.jsxs)(n.p,{children:["Since Jest 22.1.0+, the ",(0,t.jsx)(n.code,{children:"jest.spyOn"})," method takes an optional third argument of ",(0,t.jsx)(n.code,{children:"accessType"})," that can be either ",(0,t.jsx)(n.code,{children:"'get'"})," or ",(0,t.jsx)(n.code,{children:"'set'"}),", which proves to be useful when you want to spy on a getter or a setter, respectively."]}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const video = {\n  // it's a getter!\n  const video = {\n  // it's a getter!\n  get play() {\n    return true;\n  },\n};\n\nmodule.exports = video;\n\nconst audio = {\n  _volume: false,\n  // it's a setter!\n  set volume(value) {\n    this._volume = value;\n  },\n  get volume() {\n    return this._volume;\n  },\n};\n\nmodule.exports = audio;\n  set volume(value) {\n    this._volume = value;\n  },\n  get volume() {\n    return this._volume;\n  },\n};\n\nmodule.exports = audio;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example test:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const audio = require('./audio');\nconst video = require('./video');\n\nafterEach(() => {\n  // restore the spy created with spyOn\n  jest.restoreAllMocks();\n});\n\ntest('plays video', () => {\n  const spy = jest.spyOn(video, 'play', 'get'); // we pass 'get'\n  const isPlaying = video.play();\n\n  expect(spy).toHaveBeenCalled();\n  expect(isPlaying).toBe(true);\n});\n\ntest('plays audio', () => {\n  const spy = jest.spyOn(audio, 'volume', 'set'); // we pass 'set'\n  audio.volume = 100;\n\n  expect(spy).toHaveBeenCalled();\n  expect(audio.volume).toBe(100);\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"jestreplacedsource",children:(0,t.jsx)(n.code,{children:"jest.Replaced<Source>"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#replacedpropertyreplacevaluevalue",children:"TypeScript Usage"})," chapter of Mock Functions page for documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"jestspiedsource",children:(0,t.jsx)(n.code,{children:"jest.Spied<Source>"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#jestspiedsource",children:"TypeScript Usage"})," chapter of Mock Functions page for documentation."]}),"\n",(0,t.jsx)(n.h3,{id:"jestclearallmocks",children:(0,t.jsx)(n.code,{children:"jest.clearAllMocks()"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6e05\u9664\u6240\u6709\u6a21\u62df\u7684\u5c5e\u6027\uff1a ",(0,t.jsx)(n.code,{children:"mock.calls"}),", ",(0,t.jsx)(n.code,{children:"mock.instances"}),", ",(0,t.jsx)(n.code,{children:"mock.context"})," \u548c ",(0,t.jsx)(n.code,{children:"mock.results"})," \u3002 Clears the ",(0,t.jsx)(n.code,{children:"mock.calls"})," and ",(0,t.jsx)(n.code,{children:"mock.instances"})," properties of all mocks. Equivalent to calling ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#mockfnmockclear",children:(0,t.jsx)(n.code,{children:".mockClear()"})})," on every mocked function."]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestresetallmocks",children:(0,t.jsx)(n.code,{children:"jest.resetAllMocks()"})}),"\n",(0,t.jsxs)(n.p,{children:["Resets the state of all mocks. Resets the state of all mocks. Equivalent to calling ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#mockfnmockreset",children:(0,t.jsx)(n.code,{children:".mockReset()"})})," on every mocked function."]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestrestoreallmocks",children:(0,t.jsx)(n.code,{children:"jest.restoreAllMocks()"})}),"\n",(0,t.jsxs)(n.p,{children:["Restores all mocks and replaced properties back to their original value. Equivalent to calling ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#mockfnmockrestore",children:(0,t.jsx)(n.code,{children:".mockRestore()"})})," on every mocked function and ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api#replacedpropertyrestore",children:(0,t.jsx)(n.code,{children:".restore()"})})," on every replaced property. Beware that ",(0,t.jsx)(n.code,{children:"jest.restoreAllMocks()"})," only works for mocks created with ",(0,t.jsx)(n.a,{href:"#jestspyonobject-methodname",children:(0,t.jsx)(n.code,{children:"jest.spyOn()"})})," and properties replaced with ",(0,t.jsx)(n.a,{href:"#jestreplacepropertyobject-propertykey-value",children:(0,t.jsx)(n.code,{children:"jest.replaceProperty()"})}),"; other mocks will require you to manually restore them."]}),"\n",(0,t.jsx)(n.h2,{id:"\u5047\u7684\u5b9a\u65f6\u5668",children:"\u5047\u7684\u5b9a\u65f6\u5668"}),"\n",(0,t.jsx)(n.h3,{id:"jestusefaketimersfaketimersconfig",children:(0,t.jsx)(n.code,{children:"jest.useFakeTimers(fakeTimersConfig?)"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6307\u5b9a Jest \u4f7f\u7528\u5047\u7684\u5168\u5c40\u65e5\u671f\u3001\u6027\u80fd\u3001\u65f6\u95f4\u548c\u5b9a\u65f6\u5668 API\u3002 \u5047\u5b9a\u65f6\u5668\u5b9e\u73b0\u7531 ",(0,t.jsx)(n.a,{href:"https://github.com/sinonjs/fake-timers",children:(0,t.jsx)(n.code,{children:"@sinonjs/fake-timaters"})})," \u652f\u6301\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5047\u5b9a\u65f6\u5668\u4f1a\u66ff\u6362  ",(0,t.jsx)(n.code,{children:"Date"}),", ",(0,t.jsx)(n.code,{children:"performance.now()"}),", ",(0,t.jsx)(n.code,{children:"queueMicrotask()"}),", ",(0,t.jsx)(n.code,{children:"setImmediate()"}),", ",(0,t.jsx)(n.code,{children:"clearImmediate()"}),", ",(0,t.jsx)(n.code,{children:"setInterval()"}),", ",(0,t.jsx)(n.code,{children:"clearInterval()"}),", ",(0,t.jsx)(n.code,{children:"setTimeout()"}),", ",(0,t.jsx)(n.code,{children:"clearTimeout()"})," \u7684\u5b9e\u73b0\u4ece\u800c\u83b7\u5f97\u5047\u65f6\u95f4\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 Node \u73af\u5883\u4e0b\u7684 ",(0,t.jsx)(n.code,{children:"process.hrtime"}),", ",(0,t.jsx)(n.code,{children:"process.nextTick()"})," \u548c JSDOM \u73af\u5883\u4e0b\u7684 ",(0,t.jsx)(n.code,{children:"requestAnimationFrame()"}),", ",(0,t.jsx)(n.code,{children:"cancelAnimationFrame()"}),", ",(0,t.jsx)(n.code,{children:"requestIdleCallback()"}),", ",(0,t.jsx)(n.code,{children:"cancelIdleCallback()"})," \u540c\u6837\u4f1a\u88ab\u66ff\u6362\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u914d\u7f6e\u9009\u9879"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"type FakeableAPI =\n  | 'Date'\n  | 'hrtime'\n  | 'nextTick'\n  | 'performance'\n  | 'queueMicrotask'\n  | 'requestAnimationFrame'\n  | 'cancelAnimationFrame'\n  | 'requestIdleCallback'\n  | 'cancelIdleCallback'\n  | 'setImmediate'\n  | 'clearImmediate'\n  | 'setInterval'\n  | 'clearInterval'\n  | 'setTimeout'\n  | 'clearTimeout';\n\ntype FakeTimersConfig = {\n  /**\n   * \u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0c\u6240\u6709\u5b9a\u65f6\u5668\u6bcf\u969420ms\u4f1a\u63d0\u524d20ms\n   * \u8bbe\u7f6e\u6570\u5b57\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u65f6\u95f4\u95f4\u9694\n   * \u9ed8\u8ba4\u4e3a false\n   */\n  advanceTimers?: boolean | number;\n  /**\n   * \u4f20\u5165\u4e0d\u8be5\u88ab\u66ff\u6362\u7684API\u5217\u8868 \u9ed8\u8ba4\u662f [] \u4ee3\u8868\u5168\u90e8\u7684API\u90fd\u88ab\u4f1a\u66ff\u6362\n   */\n  doNotFake?: Array<FakeableAPI>;\n  /**\n   * \u4f7f\u7528\u539f\u6709\u7684\u5b9a\u65f6\u5668\u5b9e\u73b0\u800c\u4e0d\u662f`@sinonjs/fake-timers`\u63d0\u4f9b\u7684\n   * \u9ed8\u8ba4\u4e3a false\n   */\n  legacyFakeTimers?: boolean;\n  /** \u8bbe\u7f6e\u5047\u5b9a\u65f6\u5668\u7684\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4 \u9ed8\u8ba4\u503c\u662f `Date.now ()`\u3002 */\n  now?: number | Date;\n  /**\n   * \u8c03\u7528 `jest.runAllTimers()`.\u65f6\u8fd0\u884c\u7684\u5b9a\u65f6\u5668\u6700\u5927\u6570\u91cf\n   * \u9ed8\u8ba4\u503c\u662f `100_000` \u8ba1\u65f6\u5668\u3002\n   */\n  timerLimit?: number;\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"jest.useFakeTimers()"})," \u5c06\u5728\u6240\u6709\u6d4b\u8bd5\u4e2d\u4f7f\u7528\u5047\u5b9a\u65f6\u5668\uff0c\u76f4\u5230\u8c03\u7528",(0,t.jsx)(n.code,{children:"jest.useRealTimers()"}),"\u6062\u590d\u4f7f\u7528\u539f\u5b9a\u65f6\u5668"]}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"jest.useFakeTimers()"})," \u6216 ",(0,t.jsx)(n.code,{children:"jest.useRealTimers()"}),"(\u5982\u9876\u5c42\uff0c",(0,t.jsx)(n.code,{children:"it"}),"\u5185\u90e8\u7b49)\u3002 \u8bf7\u8bb0\u4f4f\uff0c\u8fd9\u662f\u4e00\u4e2a ",(0,t.jsx)(n.strong,{children:"\u5168\u5c40\u64cd\u4f5c"})," \uff0c\u5e76\u5c06\u5f71\u54cd\u5230\u540c\u4e00\u6587\u4ef6\u4e2d\u7684\u5176\u4ed6\u6d4b\u8bd5\u3002 \u5728\u540c\u4e00\u6d4b\u8bd5\u6587\u4ef6\u5185\u518d\u6b21\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"jest.useFakeTimers()"})," \u4f1a\u91cd\u7f6e\u5185\u90e8\u72b6\u6001\uff08\u5982\u8ba1\u65f6\u5668\u8ba1\u6570\uff09\uff0c\u5e76\u4f7f\u7528\u63d0\u4f9b\u7684\u9009\u9879\u91cd\u65b0\u8f7d\u5165\u5047\u5b9a\u65f6\u5668\u66ff\u6362\u539f\u751f\u7684API\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"test('advance the timers automatically', () => {\n  jest.useFakeTimers({advanceTimers: true});\n  // ...\n});\n\ntest('do not advance the timers and do not fake `performance`', () => {\n  jest.useFakeTimers({doNotFake: ['performance']});\n  // ...\n});\n\ntest('uninstall fake timers for the rest of tests in the file', () => {\n  jest.useRealTimers();\n  // ...\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u65e7\u7248\u672c\u7684\u5047\u5b9a\u65f6\u5668"}),"\n",(0,t.jsx)(n.p,{children:"\u51fa\u4e8e\u67d0\u4e9b\u539f\u56e0\uff0c\u4f60\u53ef\u80fd\u4e0d\u5f97\u4e0d\u4f7f\u7528\u65e7\u7248\u672c\u7684\u5047\u5b9a\u65f6\u5668\u3002 \u53ef\u4ee5\u50cf\u8fd9\u6837\u542f\u7528 (\u4e0d\u652f\u6301\u5176\u4ed6\u9009\u9879)\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"jest.useFakeTimers({\n  legacyFakeTimers: true,\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u65e7\u7248\u672c\u7684\u5047\u5b9a\u65f6\u5668\u4f7f\u7528 Jest ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/mock-function-api",children:"mock functions"})," \u66ff\u6362\u6389 ",(0,t.jsx)(n.code,{children:"setImmediate()"}),", ",(0,t.jsx)(n.code,{children:"clearImmediate()"}),", ",(0,t.jsx)(n.code,{children:"setInterval()"}),", ",(0,t.jsx)(n.code,{children:"clearInterval()"}),", ",(0,t.jsx)(n.code,{children:"setTimeout()"}),", ",(0,t.jsx)(n.code,{children:"clearTimeout()"}),"\uff0c \u4ee5\u53ca Node \u73af\u5883\u4e0b\u7684 ",(0,t.jsx)(n.code,{children:"process.nextTick()"})," \uff0cJSDOM \u73af\u5883\u4e0b\u7684 ",(0,t.jsx)(n.code,{children:"requestAnimationFrame()"}),", ",(0,t.jsx)(n.code,{children:"cancelAnimationFrame()"})]}),"\n",(0,t.jsx)(n.p,{children:":::"}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestuserealtimers",children:(0,t.jsx)(n.code,{children:"jest.useRealTimers()"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6307\u5b9a Jest \u4f7f\u7528\u771f\u5b9e\u7684\u5168\u5c40\u65e5\u671f\u3001\u6027\u80fd\u3001\u65f6\u95f4\u548c\u5b9a\u65f6\u5668 API\u3002 \u6bd4\u5982\uff0c\u4f60\u53ef\u4ee5\u5728 ",(0,t.jsx)(n.code,{children:"afterEach"})," \u91cc\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"jest.useRealTimers()"})," \u5b9e\u73b0\u6bcf\u4e00\u6b21\u6d4b\u8bd5\u7ed3\u675f\u540e\u6062\u590d\u771f\u5b9e\u7684\u5b9a\u65f6\u5668\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"afterEach(() => {\n  jest.useRealTimers();\n});\n\ntest('do something with fake timers', () => {\n  jest.useFakeTimers();\n  // ...\n});\n\ntest('do something with real timers', () => {\n  // ...\n});\n});\n\ntest('do something with real timers', () => {\n  // ...\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"jestrunallticks",children:(0,t.jsx)(n.code,{children:"jest.runAllTicks()"})}),"\n",(0,t.jsxs)(n.p,{children:["Exhausts the ",(0,t.jsx)(n.strong,{children:"micro"}),"-task queue (usually interfaced in node via ",(0,t.jsx)(n.code,{children:"process.nextTick"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["When this API is called, all pending micro-tasks that have been queued via ",(0,t.jsx)(n.code,{children:"process.nextTick"})," will be executed. Additionally, if those micro-tasks themselves schedule new micro-tasks, those will be continually exhausted until there are no more micro-tasks remaining in the queue. Additionally, if those micro-tasks themselves schedule new micro-tasks, those will be continually exhausted until there are no more micro-tasks remaining in the queue."]}),"\n",(0,t.jsx)(n.h3,{id:"jestrunalltimers",children:(0,t.jsx)(n.code,{children:"jest.runAllTimers()"})}),"\n",(0,t.jsxs)(n.p,{children:["Exhausts both the ",(0,t.jsx)(n.strong,{children:"macro"}),"-task queue (i.e., all tasks queued by ",(0,t.jsx)(n.code,{children:"setTimeout()"}),", ",(0,t.jsx)(n.code,{children:"setInterval()"}),", and ",(0,t.jsx)(n.code,{children:"setImmediate()"}),") and the ",(0,t.jsx)(n.strong,{children:"micro"}),"-task queue (usually interfaced in node via ",(0,t.jsx)(n.code,{children:"process.nextTick"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"When this API is called, all pending macro-tasks and micro-tasks will be executed. If those tasks themselves schedule new tasks, those will be continually exhausted until there are no more tasks remaining in the queue. If those tasks themselves schedule new tasks, those will be continually exhausted until there are no more tasks remaining in the queue."}),"\n",(0,t.jsxs)(n.p,{children:["This is often useful for synchronously executing setTimeouts during a test in order to synchronously assert about some behavior that would only happen after the ",(0,t.jsx)(n.code,{children:"setTimeout()"})," or ",(0,t.jsx)(n.code,{children:"setInterval()"})," callbacks executed. See the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/timer-mocks",children:"Timer mocks"})," doc for more information. See the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/timer-mocks",children:"Timer mocks"})," doc for more information."]}),"\n",(0,t.jsx)(n.h3,{id:"jestrunallimmediates",children:(0,t.jsx)(n.code,{children:"jest.runAllImmediates()"})}),"\n",(0,t.jsxs)(n.p,{children:["Exhausts all tasks queued by ",(0,t.jsx)(n.code,{children:"setImmediate()"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\u6b64\u529f\u80fd\u4ec5\u5728\u4f7f\u7528\u65e7\u7684\u5047\u5b9a\u65f6\u5668\u5b9e\u73b0\u65f6\u624d\u53ef\u7528\u3002"})}),"\n",(0,t.jsx)(n.h3,{id:"jestadvancetimersbytimemstorun",children:(0,t.jsx)(n.code,{children:"jest.advanceTimersByTime(msToRun)"})}),"\n",(0,t.jsxs)(n.p,{children:["Executes only the macro task queue (i.e. all tasks queued by ",(0,t.jsx)(n.code,{children:"setTimeout()"})," or ",(0,t.jsx)(n.code,{children:"setInterval()"})," and ",(0,t.jsx)(n.code,{children:"setImmediate()"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["\u901a\u8fc7\u8c03\u7528",(0,t.jsx)(n.code,{children:"msToRun"}),"\u8fd9\u4e2a API\u65f6\uff0c \u6240\u6709\u8ba1\u65f6\u5668\u90fd\u5c06\u4ee5\u6beb\u79d2\u589e\u957f\u3002 When this API is called, all timers are advanced by ",(0,t.jsx)(n.code,{children:"msToRun"}),' milliseconds. All pending "macro-tasks" that have been queued via ',(0,t.jsx)(n.code,{children:"setTimeout()"})," or ",(0,t.jsx)(n.code,{children:"setInterval()"}),", and would be executed within this time frame will be executed. Additionally, if those macro-tasks schedule new macro-tasks that would be executed within the same time frame, those will be executed until there are no more macro-tasks remaining in the queue, that should be run within ",(0,t.jsx)(n.code,{children:"msToRun"})," milliseconds. Additionally, if those macro-tasks schedule new macro-tasks that would be executed within the same time frame, those will be executed until there are no more macro-tasks remaining in the queue, that should be run within ",(0,t.jsx)(n.code,{children:"msToRun"})," milliseconds."]}),"\n",(0,t.jsx)(n.h3,{id:"jestrunonlypendingtimers",children:(0,t.jsx)(n.code,{children:"jest.runOnlyPendingTimers()"})}),"\n",(0,t.jsxs)(n.p,{children:["Executes only the macro-tasks that are currently pending (i.e., only the tasks that have been queued by ",(0,t.jsx)(n.code,{children:"setTimeout()"})," or ",(0,t.jsx)(n.code,{children:"setInterval()"})," up to this point). If any of the currently pending macro-tasks schedule new macro-tasks, those new tasks will not be executed by this call. If any of the currently pending macro-tasks schedule new macro-tasks, those new tasks will not be executed by this call."]}),"\n",(0,t.jsxs)(n.p,{children:["This is useful for scenarios such as one where the module being tested schedules a ",(0,t.jsx)(n.code,{children:"setTimeout()"})," whose callback schedules another ",(0,t.jsx)(n.code,{children:"setTimeout()"})," recursively (meaning the scheduling never stops). In these scenarios, it's useful to be able to run forward in time by a single step at a time. In these scenarios, it's useful to be able to run forward in time by a single step at a time."]}),"\n",(0,t.jsx)(n.h3,{id:"jestadvancetimerstonexttimersteps",children:(0,t.jsx)(n.code,{children:"jest.advanceTimersToNextTimer(steps)"})}),"\n",(0,t.jsx)(n.p,{children:"Advances all timers by the needed milliseconds so that only the next timeouts/intervals will run."}),"\n",(0,t.jsxs)(n.p,{children:["Optionally, you can provide ",(0,t.jsx)(n.code,{children:"steps"}),", so it will run ",(0,t.jsx)(n.code,{children:"steps"})," amount of next timeouts/intervals."]}),"\n",(0,t.jsx)(n.h3,{id:"jestclearalltimers",children:(0,t.jsx)(n.code,{children:"jest.clearAllTimers()"})}),"\n",(0,t.jsx)(n.p,{children:"Removes any pending timers from the timer system."}),"\n",(0,t.jsx)(n.p,{children:"This means, if any timers have been scheduled (but have not yet executed), they will be cleared and will never have the opportunity to execute in the future."}),"\n",(0,t.jsx)(n.h3,{id:"jestgettimercount",children:(0,t.jsx)(n.code,{children:"jest.getTimerCount()"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the number of fake timers still left to run."}),"\n",(0,t.jsx)(n.h3,{id:"jestnow",children:(0,t.jsx)(n.code,{children:"jest.now()"})}),"\n",(0,t.jsxs)(n.p,{children:["Returns the time in ms of the current clock. This is equivalent to ",(0,t.jsx)(n.code,{children:"Date.now()"})," if real timers are in use, or if ",(0,t.jsx)(n.code,{children:"Date"})," is mocked. In other cases (such as legacy timers) it may be useful for implementing custom mocks of ",(0,t.jsx)(n.code,{children:"Date.now()"}),", ",(0,t.jsx)(n.code,{children:"performance.now()"}),", etc."]}),"\n",(0,t.jsx)(n.h3,{id:"jestsetsystemtimenow-number--date",children:(0,t.jsx)(n.code,{children:"jest.setSystemTime(now?: number | Date)"})}),"\n",(0,t.jsxs)(n.p,{children:["Set the current system time used by fake timers. Simulates a user changing the system clock while your program is running. Set the current system time used by fake timers. Simulates a user changing the system clock while your program is running. It affects the current time but it does not in itself cause e.g. timers to fire; they will fire exactly as they would have done without the call to ",(0,t.jsx)(n.code,{children:"jest.setSystemTime()"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\u6b64\u529f\u80fd\u5728\u4f7f\u7528\u65e7\u7684\u5047\u5b9a\u65f6\u5668\u65f6\u4e0d\u53ef\u7528\u3002"})}),"\n",(0,t.jsx)(n.h3,{id:"jestgetrealsystemtime",children:(0,t.jsx)(n.code,{children:"jest.getRealSystemTime()"})}),"\n",(0,t.jsxs)(n.p,{children:["When mocking time, ",(0,t.jsx)(n.code,{children:"Date.now()"})," will also be mocked. If you for some reason need access to the real current time, you can invoke this function. If you for some reason need access to the real current time, you can invoke this function."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\u6b64\u529f\u80fd\u5728\u4f7f\u7528\u65e7\u7684\u5047\u5b9a\u65f6\u5668\u65f6\u4e0d\u53ef\u7528\u3002"})}),"\n",(0,t.jsx)(n.h2,{id:"misc",children:"Misc"}),"\n",(0,t.jsx)(n.h3,{id:"jestgetseed",children:(0,t.jsx)(n.code,{children:"jest.getSeed()"})}),"\n",(0,t.jsx)(n.p,{children:"Every time Jest runs a seed value is randomly generated which you could use in a pseudorandom number generator or anywhere else."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/cli#--showseed",children:(0,t.jsx)(n.code,{children:"--showSeed"})})," flag to print the seed in the test report summary. To manually set the value of the seed use ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/cli#--seednum",children:(0,t.jsx)(n.code,{children:"--seed=<num>"})})," CLI argument."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestisenvironmenttorndown",children:(0,t.jsx)(n.code,{children:"jest.isEnvironmentTornDown()"})}),"\n",(0,t.jsxs)(n.p,{children:["Returns ",(0,t.jsx)(n.code,{children:"true"})," if test environment has been torn down."]}),"\n",(0,t.jsx)(n.h3,{id:"jestretrytimesnumretries-options",children:(0,t.jsx)(n.code,{children:"jest.retryTimes(numRetries, options?)"})}),"\n",(0,t.jsx)(n.p,{children:"Runs failed tests n-times until they pass or until the max number of retries is exhausted."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"jest.retryTimes(3);\n\ntest('will fail', () => {\n  expect(true).toBe(false);\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"logErrorsBeforeRetry"})," option is enabled, error(s) that caused the test to fail will be logged to the console."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"jest.retryTimes(3, {logErrorsBeforeRetry: true});\n\ntest('will fail', () => {\n  expect(true).toBe(false);\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"jest"})," \u5bf9\u8c61\u8fdb\u884c\u94fe\u5f0f\u64cd\u4f5c\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"jest.retryTimes()"})," must be declared at the top level of a test file or in a ",(0,t.jsx)(n.code,{children:"describe"})," block."]})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["This function is only available with the default ",(0,t.jsx)(n.a,{href:"https://github.com/jestjs/jest/tree/main/packages/jest-circus",children:"jest-circus"})," runner."]})}),"\n",(0,t.jsx)(n.h3,{id:"jestsettimeouttimeout",children:(0,t.jsx)(n.code,{children:"jest.setTimeout(timeout)"})}),"\n",(0,t.jsx)(n.p,{children:"Set the default timeout interval (in milliseconds) for all tests and before/after hooks in the test file. This only affects the test file from which this function is called. The default timeout interval is 5 seconds if this method is not called."}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"jest.setTimeout(1000); // 1 second\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["To set timeout intervals on different tests in the same file, use the ",(0,t.jsxs)(n.a,{href:"/zh-Hans/docs/29.4/api#testname-fn-timeout",children:[(0,t.jsx)(n.code,{children:"timeout"})," option on each individual test"]}),"."]}),(0,t.jsxs)(n.p,{children:["If you want to set the timeout for all test files, use ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/configuration#testtimeout-number",children:(0,t.jsx)(n.code,{children:"testTimeout"})})," configuration option."]})]})]})}const p=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(j,e)})):j(e)}},6146:(e,n,s)=>{s.d(n,{ZP:()=>l});var t=s(4246),o=s(1670);function i(e){const n=Object.assign({admonition:"admonition",p:"p",pre:"pre",code:"code",a:"a"},(0,o.ah)(),e.components);return(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.p,{children:"The TypeScript examples from this page will only work as documented if you explicitly import Jest APIs:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import {expect, jest, test} from '@jest/globals';\n"})}),(0,t.jsxs)(n.p,{children:["Consult the ",(0,t.jsx)(n.a,{href:"/zh-Hans/docs/29.4/getting-started#using-typescript",children:"Getting Started"})," guide for details on how to setup Jest with TypeScript."]})]})}const l=function(e={}){const{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(i,e)})):i(e)}}}]);